"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[577],{5926:function(e,t,n){n.r(t),n.d(t,{SignIn:function(){return ue},SignInModal:function(){return fe}});var i=n(2903),r=n(2784),o=n(3936),a=n(8173),l=n(6839),s=n(3736),c=n(8147),d=n(7756),u=n(1149),f=n(7158),h=n(6046),p=n(2162),g=n(9912);const C=(0,c.P5)((0,d.withCardStateProvider)((()=>{const e=(0,f.v)(),{navigate:t}=(0,h.s0)(),{applicationName:n,userProfileUrl:r,signInUrl:o,afterSignOutAllUrl:s}=(0,a.useEnvironment)().displayConfig,{navigateAfterSignIn:c}=(0,a.useSignInContext)(),{handleSignOutAllClicked:C,handleSessionClicked:m,activeSessions:v,handleAddAccountClicked:S}=(0,g.Z)({navigateAfterSignOut:()=>t(s),navigateAfterSwitchSession:c,userProfileUrl:r,signInUrl:o,user:void 0});return(0,i.tZ)(l.Flow.Part,{part:"accountSwitcher",children:(0,i.BX)(d.Card,{children:[(0,i.tZ)(d.CardAlert,{children:e.error}),(0,i.BX)(d.Header.Root,{children:[(0,i.tZ)(d.Header.Title,{children:"Signed out"}),(0,i.BX)(d.Header.Subtitle,{children:["Select account to continue to ",n]})]}),(0,i.BX)(l.Col,{elementDescriptor:l.descriptors.main,gap:8,children:[(0,i.tZ)(l.Col,{children:v.map((e=>(0,i.tZ)(d.PreviewButton,{onClick:m(e),sx:e=>({height:e.sizes.$14,justifyContent:"flex-start"}),children:(0,i.tZ)(d.UserPreview,{user:e.user})},e.id)))}),(0,i.BX)(l.Col,{gap:2,children:[(0,i.tZ)(u.$,{isDisabled:e.isLoading,icon:(0,i.tZ)(l.Icon,{size:"sm",icon:p.v3,sx:e=>({color:e.colors.$blackAlpha500})}),onClick:S,children:"Add account"}),(0,i.tZ)(u.$,{isDisabled:e.isLoading,icon:(0,i.tZ)(l.Icon,{icon:p.kM,sx:e=>({color:e.colors.$blackAlpha500})}),onClick:C,children:"Sign out of all accounts"})]})]})]})})})));var m=n(4334),v=n(2729);const S=e=>{const{onBackLinkClick:t}=e;return(0,i.tZ)(d.ErrorCard,{cardTitle:(0,l.localizationKeys)("signIn.alternativeMethods.getHelp.title"),onBackLinkClick:t})};var k=n(6874),I=n(7568),y=n(8568);const b=r.memo((e=>{const t=(0,a.useCoreClerk)(),{navigate:n}=(0,h.s0)(),r=(0,f.v)(),{displayConfig:o}=(0,I.O)(),l=(0,a.useSignInContext)(),s=(0,a.useCoreSignIn)(),c=(0,k.w)(l,o.signInUrl),d=l.afterSignInUrl||o.afterSignInUrl;return(0,i.tZ)(y.L,{...e,oauthCallback:e=>s.authenticateWithRedirect({strategy:e,redirectUrl:c,redirectUrlComplete:d}).catch((e=>(0,v.S3)(e,[],r.setError))),web3Callback:()=>t.authenticateWithMetamask({customNavigate:n,redirectUrl:d,signUpContinueUrl:l.signUpContinueUrl}).catch((e=>(0,v.S3)(e,[],r.setError)))})}));var Z=n(172);const w=e=>e.reduce(((e,t,n)=>(e[t]=n,e)),{}),F=w(["password","email_link","email_code","phone_code"]),_=w(["email_link","email_code","phone_code","password"]),A=w(["email_link","email_code","phone_code","password"]),B=e=>(t,n)=>{const i=e[t.strategy],r=e[n.strategy];return void 0===i||void 0===r?0:i-r},L=B(F),z=B(_);B(A);const K=e=>t=>"safeIdentifier"in t&&t.safeIdentifier===e;const T=["email_code","password","phone_code","email_link"];function M(e){return!!e&&T.includes(e.strategy)}const P=e=>{const[t,n]=r.useState(!1),o=r.useCallback((()=>n((e=>!e))),[n]);return t?(0,i.tZ)(S,{onBackLinkClick:o}):(0,i.tZ)(E,{onBackLinkClick:e.onBackLinkClick,onFactorSelected:e.onFactorSelected,onHavingTroubleClick:o})},E=e=>{const{onBackLinkClick:t,onHavingTroubleClick:n,onFactorSelected:r}=e,o=(0,f.v)(),{supportedFirstFactors:s}=(0,a.useCoreSignIn)(),c=s.filter((e=>!e.strategy.startsWith("oauth_"))).filter((e=>M(e))).sort(v.U6);return(0,i.tZ)(l.Flow.Part,{part:"alternativeMethods",children:(0,i.BX)(d.Card,{children:[(0,i.tZ)(d.CardAlert,{children:o.error}),(0,i.BX)(d.Header.Root,{children:[t&&(0,i.tZ)(d.Header.BackLink,{onClick:t}),(0,i.tZ)(d.Header.Title,{localizationKey:(0,l.localizationKeys)("signIn.alternativeMethods.title")})]}),(0,i.BX)(l.Flex,{direction:"col",elementDescriptor:l.descriptors.main,gap:8,children:[(0,i.tZ)(b,{enableWeb3Providers:!0,enableOAuthProviders:!0}),(0,i.tZ)(l.Flex,{elementDescriptor:l.descriptors.alternativeMethods,direction:"col",gap:2,children:c.map(((e,t)=>(0,i.tZ)(d.ArrowBlockButton,{textLocalizationKey:U(e),elementDescriptor:l.descriptors.alternativeMethodsBlockButton,textElementDescriptor:l.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:l.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:o.isLoading,onClick:()=>r(e)},t)))})]}),(0,i.BX)(d.Footer.Root,{children:[(0,i.tZ)(d.Footer.Action,{elementId:"havingTrouble",children:(0,i.tZ)(d.Footer.ActionLink,{localizationKey:(0,l.localizationKeys)("signIn.alternativeMethods.actionLink"),onClick:n})}),(0,i.tZ)(d.Footer.Links,{})]})]})})};function U(e){switch(e.strategy){case"email_link":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__emailLink",{identifier:(0,v.HT)(e.safeIdentifier)||""});case"email_code":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__emailCode",{identifier:(0,v.HT)(e.safeIdentifier)||""});case"phone_code":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__phoneCode",{identifier:(0,v.HT)(e.safeIdentifier)||""});case"password":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__password");default:throw`Invalid sign in strategy: "${e.strategy}"`}}var R=n(361),x=n(8150);const H=e=>{const t=(0,a.useCoreSignIn)(),n=(0,f.v)(),{navigate:o}=(0,s.useRouter)(),{navigateAfterSignIn:l}=(0,a.useSignInContext)(),{setActive:c}=(0,a.useCoreClerk)(),u=(0,x.H)();r.useEffect((()=>{e.factorAlreadyPrepared||h()}),[]);const h=()=>{t.prepareFirstFactor(e.factor).then((()=>e.onFactorPrepare())).catch((e=>(0,v.S3)(e,[],n.setError)))};return(0,i.tZ)(d.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,formTitle:e.formTitle,formSubtitle:e.formSubtitle,resendButton:e.resendButton,onCodeEntryFinishedAction:(n,i,r)=>{t.attemptFirstFactor({strategy:e.factor.strategy,code:n}).then((async e=>{switch(await i(),e.status){case"complete":return c({session:e.createdSessionId,beforeEmit:l});case"needs_second_factor":return o("../factor-two");default:return console.error((0,R.Ws)(e.status,u))}})).catch((e=>r(e)))},onResendCodeClicked:h,safeIdentifier:e.factor.safeIdentifier,profileImageUrl:t.userData.profileImageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked,onIdentityPreviewEditClicked:()=>o("../")})},D=e=>{const{applicationName:t}=(0,a.useEnvironment)().displayConfig;return(0,i.tZ)(l.Flow.Part,{part:"emailCode",children:(0,i.tZ)(H,{...e,cardTitle:(0,l.localizationKeys)("signIn.emailCode.title"),cardSubtitle:(0,l.localizationKeys)("signIn.emailCode.subtitle",{applicationName:t}),formTitle:(0,l.localizationKeys)("signIn.emailCode.formTitle"),formSubtitle:(0,l.localizationKeys)("signIn.emailCode.formSubtitle"),resendButton:(0,l.localizationKeys)("signIn.emailCode.resendButton")})})};var O=n(5712),X=n(5345);const N=e=>{const t=(0,f.v)(),n=(0,a.useCoreSignIn)(),o=(0,a.useSignInContext)(),{signInUrl:s}=(0,a.useEnvironment)().displayConfig,{navigate:u}=(0,X.t)(),{navigateAfterSignIn:h}=(0,a.useSignInContext)(),{setActive:p}=(0,a.useCoreClerk)(),{startMagicLinkFlow:g,cancelMagicLinkFlow:C}=(0,O.j)(n),[m,S]=r.useState(!1);r.useEffect((()=>{I()}),[]);const I=()=>{g({emailAddressId:e.factor.emailAddressId,redirectUrl:(0,k.V)(o,s)}).then((e=>y(e))).catch((e=>(0,v.S3)(e,[],t.setError)))},y=async e=>{const n=e.firstFactorVerification;"expired"===n.status?t.setError("The verification link expired. Please resend it."):n.verifiedFromTheSameClient()?S(!0):await b(e)},b=async e=>"complete"===e.status?p({session:e.createdSessionId,beforeEmit:h}):"needs_second_factor"===e.status?u("../factor-two"):void 0;return m?(0,i.tZ)(c.Ej,{title:(0,l.localizationKeys)("signIn.emailLink.verifiedSwitchTab.titleNewTab"),subtitle:(0,l.localizationKeys)("signIn.emailLink.verifiedSwitchTab.subtitleNewTab"),status:"verified_switch_tab"}):(0,i.tZ)(l.Flow.Part,{part:"emailLink",children:(0,i.tZ)(d.VerificationLinkCard,{cardTitle:(0,l.localizationKeys)("signIn.emailLink.title"),cardSubtitle:(0,l.localizationKeys)("signIn.emailLink.subtitle"),formTitle:(0,l.localizationKeys)("signIn.emailLink.formTitle"),formSubtitle:(0,l.localizationKeys)("signIn.emailLink.formSubtitle"),resendButton:(0,l.localizationKeys)("signIn.emailLink.resendButton"),onResendCodeClicked:()=>{C(),I()},safeIdentifier:e.factor.safeIdentifier,profileImageUrl:n.userData.profileImageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked})})},W=e=>{const{onShowAlternativeMethodsClick:t}=e,n=(0,d.useCardState)(),{setActive:r}=(0,a.useCoreClerk)(),o=(0,a.useCoreSignIn)(),{navigateAfterSignIn:s}=(0,a.useSignInContext)(),c=(0,x.H)(),u=(0,v.Yp)("password","",{type:"password",label:(0,l.localizationKeys)("formFieldLabel__password")}),{navigate:f}=(0,X.t)();return(0,i.tZ)(l.Flow.Part,{part:"password",children:(0,i.BX)(d.Card,{children:[(0,i.tZ)(d.CardAlert,{children:n.error}),(0,i.BX)(d.Header.Root,{children:[(0,i.tZ)(d.Header.Title,{localizationKey:(0,l.localizationKeys)("signIn.password.title")}),(0,i.tZ)(d.Header.Subtitle,{localizationKey:(0,l.localizationKeys)("signIn.password.subtitle")})]}),(0,i.tZ)(d.IdentityPreview,{identifier:o.identifier,avatarUrl:o.userData.profileImageUrl,onClick:()=>f("../")}),(0,i.tZ)(l.Flex,{direction:"col",elementDescriptor:l.descriptors.main,gap:8,children:(0,i.BX)(d.Form.Root,{onSubmit:async e=>(e.preventDefault(),o.attemptFirstFactor({strategy:"password",password:u.value}).then((e=>{switch(e.status){case"complete":return r({session:e.createdSessionId,beforeEmit:s});case"needs_second_factor":return f("../factor-two");default:return console.error((0,R.Ws)(e.status,c))}})).catch((e=>(0,v.S3)(e,[u],n.setError)))),children:[(0,i.tZ)("input",{readOnly:!0,id:"identifier-field",name:"identifier",value:o.identifier||"",style:{display:"none"}}),(0,i.tZ)(d.Form.ControlRow,{elementId:u.id,children:(0,i.tZ)(d.Form.Control,{...u.props,autoFocus:!0,actionLabel:(0,l.localizationKeys)("formFieldAction__forgotPassword"),onActionClicked:t})}),(0,i.tZ)(d.Form.SubmitButton,{})]})}),(0,i.BX)(d.Footer.Root,{children:[(0,i.tZ)(d.Footer.Action,{elementId:"alternativeMethods",children:(0,i.tZ)(d.Footer.ActionLink,{localizationKey:(0,l.localizationKeys)("signIn.password.actionLink"),onClick:t})}),(0,i.tZ)(d.Footer.Links,{})]})]})})},V=e=>{const{applicationName:t}=(0,a.useEnvironment)().displayConfig;return(0,i.tZ)(l.Flow.Part,{part:"phoneCode",children:(0,i.tZ)(H,{...e,cardTitle:(0,l.localizationKeys)("signIn.phoneCode.title"),cardSubtitle:(0,l.localizationKeys)("signIn.phoneCode.subtitle",{applicationName:t}),formTitle:(0,l.localizationKeys)("signIn.phoneCode.formTitle"),formSubtitle:(0,l.localizationKeys)("signIn.phoneCode.formSubtitle"),resendButton:(0,l.localizationKeys)("signIn.phoneCode.resendButton")})})},$=e=>{if(!e)return"";let t=e.strategy;return"emailAddressId"in e&&(t+=e.emailAddressId),"phoneNumberId"in e&&(t+=e.phoneNumberId),t},j=(0,c.P5)((0,d.withCardStateProvider)((function(){const e=(0,a.useCoreSignIn)(),{preferredSignInStrategy:t}=(0,a.useEnvironment)().displayConfig,n=e.supportedFirstFactors,o=(0,s.useRouter)(),l=r.useRef(""),[c,u]=r.useState((()=>function(e,t,n){return e&&0!==e.length?n===Z.kJ.Password?function(e,t){const n=e.sort(L)[0];return"password"===n.strategy?n:e.find(K(t))||n||null}(e,t):function(e,t){const n=e.sort(z),i=n.find(K(t));if(i)return i;const r=n[0];return"email_link"===r.strategy?r:e.find(K(t))||r||null}(e,t):null}(n,e.identifier,t))),[f,h]=r.useState((()=>!c||!M(c)));if(r.useEffect((()=>{"needs_identifier"!==e.status&&null!==e.status||o.navigate("../")}),[]),!c&&e.status)return(0,i.tZ)(d.ErrorCard,{cardTitle:(0,m.u1)("signIn.noAvailableMethods.title"),cardSubtitle:(0,m.u1)("signIn.noAvailableMethods.subtitle"),message:(0,m.u1)("signIn.noAvailableMethods.message")});const p=()=>h((e=>!e)),g=()=>{l.current=$(c)},C=e=>{u(e),p()};if(f){const e=M(c);return(0,i.tZ)(P,{onBackLinkClick:e?p:void 0,onFactorSelected:C})}if(!c)return(0,i.tZ)(d.LoadingCard,{});switch(null==c?void 0:c.strategy){case"password":return(0,i.tZ)(W,{onShowAlternativeMethodsClick:p});case"email_code":return(0,i.tZ)(D,{factorAlreadyPrepared:l.current===$(c),onFactorPrepare:g,factor:c,onShowAlternativeMethodsClicked:p});case"phone_code":return(0,i.tZ)(V,{factorAlreadyPrepared:l.current===$(c),onFactorPrepare:g,factor:c,onShowAlternativeMethodsClicked:p});case"email_link":return(0,i.tZ)(N,{factorAlreadyPrepared:l.current===$(c),onFactorPrepare:g,factor:c,onShowAlternativeMethodsClicked:p});default:return(0,i.tZ)(d.LoadingCard,{})}}))),Y=e=>{const[t,n]=r.useState(!1),o=r.useCallback((()=>n((e=>!e))),[n]);return t?(0,i.tZ)(S,{onBackLinkClick:o}):(0,i.tZ)(q,{onBackLinkClick:e.onBackLinkClick,onFactorSelected:e.onFactorSelected,onHavingTroubleClick:o})},q=e=>{const{onBackLinkClick:t,onHavingTroubleClick:n,onFactorSelected:r}=e,o=(0,f.v)(),{supportedSecondFactors:s}=(0,a.useCoreSignIn)();return(0,i.tZ)(l.Flow.Part,{part:"alternativeMethods",children:(0,i.BX)(d.Card,{children:[(0,i.tZ)(d.CardAlert,{children:o.error}),(0,i.BX)(d.Header.Root,{children:[t&&(0,i.tZ)(d.Header.BackLink,{onClick:t}),(0,i.tZ)(d.Header.Title,{localizationKey:(0,l.localizationKeys)("signIn.alternativeMethods.title")})]}),(0,i.tZ)(l.Col,{elementDescriptor:l.descriptors.main,gap:8,children:(0,i.tZ)(l.Col,{gap:2,children:s.sort(v.Q0).map(((e,t)=>(0,i.tZ)(d.ArrowBlockButton,{textLocalizationKey:G(e),elementDescriptor:l.descriptors.alternativeMethodsBlockButton,textElementDescriptor:l.descriptors.alternativeMethodsBlockButtonText,arrowElementDescriptor:l.descriptors.alternativeMethodsBlockButtonArrow,isDisabled:o.isLoading,onClick:()=>r(e)},t)))})}),(0,i.BX)(d.Footer.Root,{children:[(0,i.tZ)(d.Footer.Action,{elementId:"havingTrouble",children:(0,i.tZ)(d.Footer.ActionLink,{localizationKey:(0,l.localizationKeys)("signIn.alternativeMethods.actionLink"),onClick:n})}),(0,i.tZ)(d.Footer.Links,{})]})]})})};function G(e){switch(e.strategy){case"phone_code":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__emailCode",{identifier:(0,v.HT)(e.safeIdentifier)||""});case"totp":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__totp");case"backup_code":return(0,l.localizationKeys)("signIn.alternativeMethods.blockButton__backupCode");default:throw`Invalid sign in strategy: "${e.strategy}"`}}const J=e=>{const{onShowAlternativeMethodsClicked:t}=e,n=(0,a.useCoreSignIn)(),{displayConfig:r}=(0,a.useEnvironment)(),{navigateAfterSignIn:o}=(0,a.useSignInContext)(),{setActive:s}=(0,a.useCoreClerk)(),c=(0,x.H)(),u=(0,d.useCardState)(),f=(0,v.Yp)("code","",{type:"text",label:(0,l.localizationKeys)("formFieldLabel__backupCode"),isRequired:!0});return(0,i.BX)(d.Card,{children:[(0,i.tZ)(d.CardAlert,{children:u.error}),(0,i.BX)(d.Header.Root,{children:[(0,i.tZ)(d.Header.Title,{localizationKey:(0,l.localizationKeys)("signIn.backupCodeMfa.title")}),(0,i.tZ)(d.Header.Subtitle,{localizationKey:(0,l.localizationKeys)("signIn.backupCodeMfa.subtitle",{applicationName:r.applicationName})})]}),(0,i.tZ)(l.Col,{elementDescriptor:l.descriptors.main,gap:8,children:(0,i.BX)(d.Form.Root,{onSubmit:async e=>(e.preventDefault(),n.attemptSecondFactor({strategy:"backup_code",code:f.value}).then((e=>"complete"===e.status?s({session:e.createdSessionId,beforeEmit:o}):console.error((0,R.Ws)(e.status,c)))).catch((e=>(0,v.S3)(e,[f],u.setError)))),children:[(0,i.tZ)(d.Form.ControlRow,{elementId:f.id,children:(0,i.tZ)(d.Form.Control,{...f.props,autoFocus:!0,onActionClicked:t})}),(0,i.tZ)(d.Form.SubmitButton,{})]})}),(0,i.BX)(d.Footer.Root,{children:[(0,i.tZ)(d.Footer.Action,{elementId:"alternativeMethods",children:t&&(0,i.tZ)(d.Footer.ActionLink,{localizationKey:(0,l.localizationKeys)("footerActionLink__useAnotherMethod"),onClick:t})}),(0,i.tZ)(d.Footer.Links,{})]})]})},Q=e=>{const t=(0,a.useCoreSignIn)(),n=(0,d.useCardState)(),{navigateAfterSignIn:o}=(0,a.useSignInContext)(),{setActive:l}=(0,a.useCoreClerk)(),s=(0,x.H)();r.useEffect((()=>{e.factorAlreadyPrepared||null==c||c()}),[]);const c=e.prepare?()=>{var t;return null===(t=e.prepare)||void 0===t?void 0:t.call(e).then((()=>e.onFactorPrepare())).catch((e=>(0,v.S3)(e,[],n.setError)))}:void 0;return(0,i.tZ)(d.VerificationCodeCard,{cardTitle:e.cardTitle,cardSubtitle:e.cardSubtitle,formTitle:e.formTitle,formSubtitle:e.formSubtitle,resendButton:e.resendButton,onCodeEntryFinishedAction:(n,i,r)=>{t.attemptSecondFactor({strategy:e.factor.strategy,code:n}).then((async e=>(await i(),"complete"===e.status?l({session:e.createdSessionId,beforeEmit:o}):console.error((0,R.Ws)(e.status,s))))).catch((e=>r(e)))},onResendCodeClicked:c,safeIdentifier:"safeIdentifier"in e.factor?e.factor.safeIdentifier:void 0,profileImageUrl:t.userData.profileImageUrl,onShowAlternativeMethodsClicked:e.onShowAlternativeMethodsClicked})},ee=e=>{const t=(0,a.useCoreSignIn)();return(0,i.tZ)(l.Flow.Part,{part:"phoneCode2Fa",children:(0,i.tZ)(Q,{...e,cardTitle:(0,l.localizationKeys)("signIn.phoneCodeMfa.title"),cardSubtitle:(0,l.localizationKeys)("signIn.phoneCodeMfa.subtitle"),formTitle:(0,l.localizationKeys)("signIn.phoneCodeMfa.formTitle"),formSubtitle:(0,l.localizationKeys)("signIn.phoneCodeMfa.formSubtitle"),resendButton:(0,l.localizationKeys)("signIn.phoneCodeMfa.resendButton"),prepare:()=>{const{phoneNumberId:n,strategy:i}=e.factor;return t.prepareSecondFactor({phoneNumberId:n,strategy:i})}})})},te=e=>(0,i.tZ)(l.Flow.Part,{part:"totp2Fa",children:(0,i.tZ)(Q,{...e,cardTitle:(0,l.localizationKeys)("signIn.totpMfa.title"),cardSubtitle:(0,l.localizationKeys)("signIn.totpMfa.subtitle"),formTitle:(0,l.localizationKeys)("signIn.totpMfa.formTitle"),formSubtitle:(0,l.localizationKeys)("signIn.totpMfa.formSubtitle")})}),ne=e=>{if(!e)return"";let t=e.strategy;return"phoneNumberId"in e&&(t+=e.phoneNumberId),t},ie=(0,c.P5)((0,d.withCardStateProvider)((function(){const e=(0,a.useCoreSignIn)().supportedSecondFactors,t=r.useRef(""),[n,o]=r.useState((()=>function(e){if(!e||0===e.length)return null;const t=e.find((e=>"totp"===e.strategy));return t||(e.find((e=>"phone_code"===e.strategy))||e[0])}(e))),[l,s]=r.useState(!n),c=()=>s((e=>!e)),u=()=>{t.current=ne(n)};if(!n)return(0,i.tZ)(d.LoadingCard,{});if(l)return(0,i.tZ)(Y,{onBackLinkClick:c,onFactorSelected:e=>{o(e),c()}});switch(null==n?void 0:n.strategy){case"phone_code":return(0,i.tZ)(ee,{factorAlreadyPrepared:t.current===ne(n),onFactorPrepare:u,factor:n,onShowAlternativeMethodsClicked:c});case"totp":return(0,i.tZ)(te,{factorAlreadyPrepared:t.current===ne(n),onFactorPrepare:u,factor:n,onShowAlternativeMethodsClicked:c});case"backup_code":return(0,i.tZ)(J,{onShowAlternativeMethodsClicked:c});default:return(0,i.tZ)(d.LoadingCard,{})}}))),re=(0,c.P5)(c.L);var oe=n(9841),ae=n(3173);const le=({field:e})=>{const[t,n]=(0,r.useState)(!1),o=(0,r.useRef)(null);return r.useLayoutEffect((()=>{const e=setInterval((()=>{if(null==o?void 0:o.current){const t="onAutoFillStart"===window.getComputedStyle(o.current,":autofill").animationName;t&&(n(t),clearInterval(e))}}),500);return()=>{clearInterval(e)}}),[]),(0,r.useEffect)((()=>{(null==e?void 0:e.value)&&""!==e.value&&n(!1)}),[null==e?void 0:e.value]),e?(0,i.tZ)(d.Form.ControlRow,{elementId:e.id,sx:e.value||t?void 0:{opacity:0,height:0,pointerEvents:"none",marginTop:"-1rem"},children:(0,i.tZ)(d.Form.Control,{...e.props,ref:o,tabIndex:e.value?void 0:-1})}):null},se=(0,c.P5)((0,d.withCardStateProvider)((function(){const e=(0,d.useCardState)(),t=(0,h._m)(),{userSettings:n}=(0,a.useEnvironment)(),{setActive:o}=(0,a.useCoreClerk)(),s=(0,a.useCoreSignIn)(),{navigate:u}=(0,h.s0)(),{navigateAfterSignIn:f,signUpUrl:p}=(0,a.useSignInContext)(),g=(0,x.H)(),C=(0,r.useMemo)((()=>(0,c.vX)(n.enabledFirstFactorIdentifiers)),[n.enabledFirstFactorIdentifiers]),[m,S]=(0,r.useState)(C[0]||""),k=(0,ae.XV)("__clerk_ticket")||"",I=n.enabledFirstFactorIdentifiers,y=n.web3FirstFactors,Z=n.authenticatableSocialStrategies,w=n.instanceIsPasswordBased,{currentIdentifier:F,nextIdentifier:_}=(0,c.vO)(C,m),A=(0,v.Yp)("password","",{type:"password",label:(0,l.localizationKeys)("formFieldLabel__password"),placeholder:(0,l.localizationKeys)("formFieldInputPlaceholder__password")}),B=(0,v.Yp)("identifier","",{...F,isRequired:!0});r.useLayoutEffect((()=>{var e;B.value.startsWith("+")&&C.includes("phone_number")&&"phone_number"!==m&&(e=B.value,S("phone_number"),B.setValue(e||""))}),[B.value,C]),r.useEffect((()=>{k&&(t.setLoading(),e.setLoading(),s.create({strategy:"ticket",ticket:k}).then((e=>{switch(e.status){case"needs_first_factor":return u("factor-one");case"needs_second_factor":return u("factor-two");case"complete":return o({session:e.createdSessionId,beforeEmit:f});default:return void console.error((0,R.Ws)(e.status,g))}})).catch((e=>z(e))).finally((()=>{t.setIdle(),e.setIdle()})))}),[]),r.useEffect((()=>{!async function(){var t;const n=null===(t=null==s?void 0:s.firstFactorVerification)||void 0===t?void 0:t.error;if(n){switch(n.code){case oe.O1.NOT_ALLOWED_TO_SIGN_UP:case oe.O1.OAUTH_ACCESS_DENIED:case oe.O1.NOT_ALLOWED_ACCESS:e.setError(n.longMessage);break;default:e.setError("Unable to complete action at this time. If the problem persists please contact support.")}await s.create({})}}()}),[]);const L=async(...e)=>{try{const t=await s.create((e=>{const t=e.some((e=>"password"===e.name&&!!e.value));return t||(e=e.filter((e=>"password"!==e.name))),{...(0,v.ni)(e),...t&&{strategy:"password"}}})(e));switch(t.status){case"needs_first_factor":return u("factor-one");case"needs_second_factor":return u("factor-two");case"complete":return o({session:t.createdSessionId,beforeEmit:f});default:return void console.error((0,R.Ws)(t.status,g))}}catch(e){return z(e)}},z=async t=>{if(!t.errors)return;const n=t.errors.find((e=>e.code===oe.O1.INVALID_STRATEGY_FOR_USER||e.code===oe.O1.FORM_PASSWORD_INCORRECT)),i=t.errors.find((e=>"identifier_already_signed_in"===e.code));if(n)await L(B);else if(i){const e=i.meta.sessionId;await o({session:e,beforeEmit:f})}else(0,v.S3)(t,[B,A],e.setError)};if(t.isLoading)return(0,i.tZ)(d.LoadingCard,{});const K=!!Z.length||!!y.length,T=!(0,v.s2)()&&K;return(0,i.tZ)(l.Flow.Part,{part:"start",children:(0,i.BX)(d.Card,{children:[(0,i.tZ)(d.CardAlert,{children:e.error}),(0,i.BX)(d.Header.Root,{children:[(0,i.tZ)(d.Header.Title,{localizationKey:(0,l.localizationKeys)("signIn.start.title")}),(0,i.tZ)(d.Header.Subtitle,{localizationKey:(0,l.localizationKeys)("signIn.start.subtitle")})]}),(0,i.tZ)(l.Col,{elementDescriptor:l.descriptors.main,gap:8,children:(0,i.BX)(d.SocialButtonsReversibleContainerWithDivider,{children:[K&&(0,i.tZ)(b,{enableWeb3Providers:!0,enableOAuthProviders:!0}),I.length?(0,i.BX)(d.Form.Root,{onSubmit:async e=>(e.preventDefault(),L(B,A)),children:[(0,i.tZ)(d.Form.ControlRow,{elementId:B.id,children:(0,i.tZ)(d.Form.Control,{actionLabel:null==_?void 0:_.action,onActionClicked:()=>{S((e=>C[(C.indexOf(e)+1)%C.length])),B.setValue("")},...B.props,autoFocus:T})}),(0,i.tZ)(le,{field:w?A:void 0}),(0,i.tZ)(d.Form.SubmitButton,{children:"Continue"})]}):null]})}),(0,i.BX)(d.Footer.Root,{children:[(0,i.BX)(d.Footer.Action,{elementId:"signIn",children:[(0,i.tZ)(d.Footer.ActionText,{localizationKey:(0,l.localizationKeys)("signIn.start.actionText"),children:"No account?"}),(0,i.tZ)(d.Footer.ActionLink,{localizationKey:(0,l.localizationKeys)("signIn.start.actionLink"),to:p,children:"Sign up"})]}),(0,i.tZ)(d.Footer.Links,{})]})]})})})));function ce(){const{redirectToSignIn:e}=(0,a.useCoreClerk)();return r.useEffect((()=>{e()}),[]),null}function de(){const e=(0,a.useSignInContext)();return(0,i.tZ)(l.Flow.Root,{flow:"signIn",children:(0,i.BX)(s.Switch,{children:[(0,i.tZ)(s.Route,{path:"factor-one",children:(0,i.tZ)(j,{})}),(0,i.tZ)(s.Route,{path:"factor-two",children:(0,i.tZ)(ie,{})}),(0,i.tZ)(s.Route,{path:"sso-callback",children:(0,i.tZ)(re,{afterSignInUrl:e.afterSignInUrl,afterSignUpUrl:e.afterSignUpUrl,redirectUrl:e.redirectUrl,secondFactorUrl:"../factor-two"})}),(0,i.tZ)(s.Route,{path:"choose",children:(0,i.tZ)(C,{})}),(0,i.tZ)(s.Route,{path:"verify",children:(0,i.tZ)(o.J,{redirectUrlComplete:e.afterSignInUrl||e.redirectUrl||void 0,redirectUrl:"../factor-two"})}),(0,i.tZ)(s.Route,{index:!0,children:(0,i.tZ)(se,{})}),(0,i.tZ)(s.Route,{children:(0,i.tZ)(ce,{})})]})})}de.displayName="SignIn";const ue=(0,a.withCoreSessionSwitchGuard)(de),fe=e=>{const t={signUpUrl:`/${s.VIRTUAL_ROUTER_BASE_PATH}/sign-up`,...e};return(0,i.tZ)(s.Route,{path:"sign-in",children:(0,i.tZ)(a.ComponentContext.Provider,{value:{componentName:"SignIn",...t,routing:"virtual"},children:(0,i.tZ)("div",{children:(0,i.tZ)(ue,{...t,routing:"virtual"})})})})}},4781:function(e,t,n){n.d(t,{v:function(){return i}});const i=({signUp:e,verifyEmailPath:t,verifyPhonePath:n,navigate:i,handleComplete:r})=>{var o,a;if("complete"===e.status)return r&&r();if("missing_requirements"===e.status){if((null===(o=e.unverifiedFields)||void 0===o?void 0:o.includes("email_address"))&&t)return i(t);if((null===(a=e.unverifiedFields)||void 0===a?void 0:a.includes("phone_number"))&&n)return i(n)}}},9912:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(196),r=n(8173),o=n(7756),a=n(6046),l=n(2729);const s=e=>{const{setActive:t,signOut:n,openUserProfile:s}=(0,r.useCoreClerk)(),c=(0,o.useCardState)(),d=(0,r.useCoreSessionList)(),{navigate:u}=(0,a.s0)(),f=d.filter((e=>"active"===e.status)),h=f.filter((t=>{var n,i;return(null===(n=t.user)||void 0===n?void 0:n.id)!==(null===(i=e.user)||void 0===i?void 0:i.id)}));return{handleSignOutSessionClicked:t=>()=>0===h.length?n(e.navigateAfterSignOut):n(e.navigateAfterMultiSessionSingleSignOut,{sessionId:t.id}).finally((()=>c.setIdle())),handleManageAccountClicked:()=>{var t,n;return"navigation"===e.userProfileMode?u(e.userProfileUrl).finally((async()=>{var t;await(0,l._v)(300),null===(t=e.actionCompleteCallback)||void 0===t||t.call(e)})):(s({...e.userProfileProps,appearance:null===(t=e.appearance)||void 0===t?void 0:t.userProfile}),null===(n=e.actionCompleteCallback)||void 0===n?void 0:n.call(e))},handleSignOutAllClicked:()=>n(e.navigateAfterSignOut),handleSessionClicked:n=>async()=>(c.setLoading(),t({session:n,beforeEmit:e.navigateAfterSwitchSession}).finally((()=>{var t;c.setIdle(),null===(t=e.actionCompleteCallback)||void 0===t||t.call(e)}))),handleAddAccountClicked:()=>((0,i.T)(e.signInUrl||window.location.href),(0,l._v)(2e3)),otherSessions:h,activeSessions:f}}}}]);